<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.eastcompeace.pubobjection.PubObjectDao">
<resultMap id="pubobjectMap" type="PubObjection">
<id column="objection_id" property="objectionId"/>
<result column="citizen_id" property="citizenId"/>
<result column="user_name" property="userName"/>
<result column="objection_content" property="objectionContent"/>       
<result column="objection_time" property="objectionTime"/>    
<result column="reply_content" property="replyContent"/>
<result column="reply_time" property="replyTime"/>
<result column="objection_status" property="objectionStatus"/>
<result column="objection_pic1" property="objectionPic1"/>
<result column="objection_pic2" property="objectionPic2"/>
<result column="objection_pic3" property="objectionPic3"/>
<result column="objection_pic4" property="objectionPic4"/>
<result column="beginDate" property="beginDate"/>
<result column="endDate" property="endDate"/>
</resultMap>
	
	<select id="queryPubObjByList" resultMap="pubobjectMap" parameterType="list">
		SELECT
			objection_id,
			objection_pic1,
			objection_pic2,
			objection_pic3,
			objection_pic4
		FROM
			pub_objection
		WHERE
			objection_id IN
		<foreach collection="list" index="index" item="item" open="("
			separator="," close=")">
			#{item}
		</foreach>
	</select>
	
	<select id="selobject" resultMap="pubobjectMap" parameterType="PubObjection">
	        select
			po.objection_id objectionId,
			po.citizen_id citizenId,
	        cu.user_name userName,
			po.objection_content objectionContent,
			date_format( po.objection_time ,'%Y-%m-%d ') objectionTime,
			po.reply_content replyContent,
			date_format( po.reply_time  ,'%Y-%m-%d ') replyTime,
			case po.objection_status 
			when 1 then '未处理'
			when 2 then '已处理'
			end objectionStatus,
			po.objection_pic1 objectionPic1,
			po.objection_pic2 objectionPic2,
			po.objection_pic3 objectionPic3,
			po.objection_pic4 objectionPic4  
			from pub_objection po
			left join citizen_user cu
			on po.citizen_id=cu.citizen_id
			where 1=1
			<if test="beginDate!=null and beginDate!='' ">
				and po.objection_time &gt;= #{beginDate}
			</if>
			<if test="endDate!=null and endDate!='' ">
				and po.objection_time &lt;= #{endDate}
			</if>
			<if test="objectionStatus != null and objectionStatus!=''">
				and po.objection_status =#{objectionStatus}
			</if>
			

	</select>

	<delete id="delobject" parameterType="list">
		delete from pub_objection where objection_id in
		<foreach collection="list" index="index" item="item" open="("
			separator="," close=")">
			#{item}
		</foreach>
	</delete>
	
	<update id="updateobject" parameterType="PubObjection">
	update pub_objection set
	<if test="replyContent != null and replyContent!=''">
		reply_content=#{replyContent}
	</if>
	<if test="replyTime != null and replyTime!=''">
		,reply_time=#{replyTime}
	</if>
	<if test="objectionStatus != null and objectionStatus!=''">
		,objection_status=#{objectionStatus}
	</if>
	where
	objection_id=#{objectionId}
	</update>
	
</mapper>
