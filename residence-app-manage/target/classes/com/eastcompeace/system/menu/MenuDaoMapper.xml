<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<!-- namespace value ： 实现的DAO接口的路径 -->
<mapper namespace="com.eastcompeace.system.menu.MenuDao">

	<!-- resultMap:定义结果集中表字段与实体类属性的映射关系 -->
	<resultMap type="Menu" id="menuMap">
		<result column="menu_id" property="menuId" />
		<result column="menu_fatherid" property="menuFatherid" />
		<result column="menu_name" property="menuName" />
		<result column="menu_desc" property="menuDesc" />
		<result column="menu_order" property="menuOrder" />
		<result column="menu_url" property="menuUrl" />
		<result column="menu_icon" property="menuIcon" />
		<result column="menu_isleaf" property="menuIsleaf" />
		<result column="menu_createuser" property="menuCreateuser" />
		<result column="menu_createip" property="menuCreateip" />
		<result column="menu_createdate" property="menuCreatedate" />
		<result column="menu_isexternal" property="menuIsexternal" />
	</resultMap>
	
	<resultMap type="menuButton" id="menuButtonMap">
	<result column="id" property="id" />
	<result column="menuid" property="menuid" />
	<result column="buttonid" property="buttonid" />
	<result column="buttontext" property="buttontext" />
	</resultMap>
	
	<resultMap type="button" id="buttonMap">
	<result column="uuid" property="uuid" />
	<result column="text" property="text" />
	<result column="icon" property="icon" />
	<result column="handler" property="handler" />
	<result column="desc" property="desc" />
	<result column="status" property="status" />
	</resultMap>
	
	<select id="queryButtonListby" resultMap="buttonMap">
		SELECT t.*  FROM common_button t WHERE t.uuid in (SELECT t1.buttonid FROM common_rolebutton_mapping t1 WHERE t1.roleid= #{0} AND t1.meunid = #{1} ) order by t.desc ASC 
	</select>
	
	<select id="queryButtonList" resultMap="buttonMap">
		select * from common_button
	</select> 
	

	<select id="queryButtonListByFid" resultMap="menuButtonMap">
		SELECT t.menuid ,
		t.buttonid ,
		t2.text buttontext
		FROM common_menubutton_mapping t
		LEFT JOIN common_button t2
		ON t.buttonid = t2.uuid
		where t.menuid =#{0}
	</select> 
	
	<select id="queryMenuby" parameterType="Menu" resultMap="menuMap">
		select * from common_menu where  menu_url = #{menuUrl}
	</select>
	

	<select id="queryMenuInfoList" resultMap="menuMap">
		select * from common_menu
	</select>

	<select id="queryMenuListByFid" parameterType="long" resultMap="menuMap">
		select * from common_menu t where t.menu_fatherid =#{0}
	</select>
	
	<select id="queryMenuListByFidroleid" parameterType="long" resultMap="menuMap">
		SELECT * FROM common_menu t RIGHT JOIN common_role_mapping t2 ON t.menu_id = t2.menu_id WHERE t.MENU_FATHERID = #{0} AND t2.role_id =#{1}
	</select>

	<select id="findMenuById" resultMap="menuMap">
		select * from common_menu t
		where t.menu_id =#{menuId}
	</select>

	<delete id="delMenuById">
		delete from common_menu where menu_id =#{menuId}
	</delete>

	<insert id="addMenuInfo" parameterType="Menu">
		insert into
		common_menu(menu_fatherid,menu_name)values(#{1},#{0})
	</insert>

	<update id="updateMenuInfo" parameterType="Menu">
		update common_menu
		<set>
			<if test="menuFatherid !=null and menuFatherid !=''">menu_fatherid=#{menuFatherid},</if>

			<if test="menuName !=null and menuName !=''">menu_name = #{menuName},</if>

			<if test="menuDesc !=null and menuDesc !=''">menu_desc = #{menuDesc},</if>

			<if test="menuOrder !=null and menuOrder !=''">menu_order=#{menuOrder},</if>

			<if test="menuUrl !=null and menuUrl !=''">menu_url=#{menuUrl},</if>

			<if test="menuIcon !=null and menuIcon !=''">menu_icon=#{menuIcon},</if>

			<if test="menuIsleaf !=null and menuIsleaf !=''">
				menu_isleaf=#{menuIsleaf},
			</if>

			<if test="menuCreateuser !=null and menuCreateuser !=''">menu_createuser=#{menuCreateuser},</if>

			<if test="menuCreateip !=null and menuCreateip !=''">
				menu_createip=#{menuCreateip},
			</if>
		</set>
		where menu_id =#{menuId}
	</update>
	
	<select id="queryMenuList" resultMap="menuMap">
		select * from common_menu where menu_id in 
		<foreach collection="list" item="menu" index="index"  open="(" separator="," close=")">
			#{menu.menuId}
		</foreach>
		order by menu_order
	</select>
	
	<delete id="delRoleMappingByMid">
		delete from common_role_mapping where menu_id = #{menuId}
	</delete>
	
	<delete id="deleteMenuButton">
		delete from common_menubutton_mapping  where menuid = #{0}
	</delete>
	
	<insert id="addMenuButton" parameterType="menuButton" useGeneratedKeys="true" keyProperty="id">
		insert into common_menubutton_mapping (
		<if test="menuid != null and menuid != ''">
			menuid,
		</if>
		<if test="buttonid != null and buttonid != ''">
			buttonid
		</if>
		)
		values
		(
		<if test="menuid != null and menuid != ''">
			#{menuid}
		</if>
		<if test="buttonid != null and buttonid != ''">
			, #{buttonid}
		</if>
		)
	</insert>
	
	<delete id="delRoleButtonMapping" parameterType="string">
		DELETE FROM 
			common_rolebutton_mapping  
		WHERE 
			meunid = #{0}
	</delete>
	
</mapper>