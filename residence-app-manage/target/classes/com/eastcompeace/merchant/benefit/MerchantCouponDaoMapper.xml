<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

	<mapper namespace="com.eastcompeace.merchant.benefit.MerchantCouponDao">

	<resultMap id="MerchantCouponMap" type="MerchantCoupon" >
	    <id column="coupon_id" property="couponId"/>
	    <result column="benefit_id" property="benefitId"/>
	    <result column="coupon_code" property="couponCode"/>
	    <result column="status" property="status"/>
	</resultMap>
  
  	<!-- 查询信息 -->
 	<select id="queryCoupon" resultMap="MerchantCouponMap" parameterType="MerchantCoupon">
		select 
			t.coupon_id couponId,
			t.benefit_id benefitId,
			t.coupon_code couponCode,
			d.code_name status
		from merchant_coupon t
		left join common_code_dict d 
			on d.code_value = t.status 
			and d.code_type='couponStatus' 
			and d.code_valid ='VALID'
		where 1=1
			<if test="benefitId !=null and benefitId !=''">
			   and t.benefit_id =#{benefitId}
		    </if>
		    <if test="couponCode !=null and couponCode !=''">
			    and t.coupon_code =#{couponCode}
		    </if>
		    <if test="status !=null and status !=''">
			    and t.status =#{status}
		    </if>
		order by t.coupon_code asc
	</select>
	
	<insert id="addcoupon" parameterType="MerchantCoupon">
		insert into merchant_coupon (benefit_id,coupon_code,status) value (#{benefitId},#{couponCode},#{status})
	</insert>
  
  	<insert id="insertMore" useGeneratedKeys="true" parameterType="List" >
    	insert into merchant_coupon (
    		benefit_id,
    		coupon_code,
			status
    	) values 
	    <foreach collection="list" item="item" index="index" separator="," >
    	(	#{item.benefitId},
        	#{item.couponCode},
        	#{item.status}
        )
	    </foreach>  
  	</insert>
  
  	<delete id="delcoupon" parameterType="list">
		delete from merchant_coupon where coupon_id in
		<foreach collection="list" index="index" item="item" open="("
			separator="," close=")">
			#{item}
		</foreach>
	</delete>
	
	<delete id="delCitizenCoupon" parameterType="list">
		delete from citizen_coupon where coupon_id in
		<foreach collection="list" index="index" item="item" open="("
			separator="," close=")">
			#{item}
		</foreach>
	</delete>
	
	<update id="updateCopon" parameterType="MerchantCoupon">
		update merchant_coupon set
			benefit_id=#{benefitId},
			coupon_code=#{couponCode},
			status=#{status}
		where coupon_id=#{couponId}
	</update>
</mapper>
