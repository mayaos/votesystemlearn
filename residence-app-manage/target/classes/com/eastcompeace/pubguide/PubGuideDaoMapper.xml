<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.eastcompeace.pubguide.PubGuideDao">
<resultMap id="pubguideMap" type="PubGuide">
<id column="guide_id" property="guideId"/>
<result column="guide_type" property="guideType"/>
<result column="area_id" property="areaId"/>
<result column="guide_content" property="guideContent"/>
<result column="user_id" property="userId"/>
<result column="valid" property="valid"/>
<result column="read_times" property="readTimes"/>
<result column="create_time" property="createTime"/>
<result column="update_time" property="updateTime"/>
<result column="guideName" property="guideName"/>
<result column="userName" property="userName"/>
<result column="areaName" property="areaName"/>

 
</resultMap>
	<select id="selectguide" resultMap="pubguideMap" parameterType="PubGuide">
		SELECT
			gu.guide_id guideId,
			gu.area_id areaId,
			gu.guide_type guideType,
			gu.guide_content guideContent,
			gu.user_id userId,
      		area.full_name areaName,
			CASE gu.valid   
				WHEN 'YES' THEN '是'
            	WHEN 'NO'  THEN '否'
     		END valid,
			gu.read_times readTimes,
			date_format(  gu.create_time  ,'%Y-%m-%d ') createTime,
			date_format( gu.update_time  ,'%Y-%m-%d ')  updateTime,
			co.USER_NAME userName,
     		dict.code_name guideName
		FROM 
			pub_guide gu 
		LEFT JOIN 
			common_user co ON gu.user_id=co.User_Id
        LEFT JOIN 
        	common_code_dict dict ON dict.code_value = gu.guide_type AND dict.code_type = 'guideType'
        LEFT JOIN 
        	conf_area area ON gu.area_id = area.area_id
		WHERE 
			1=1
     	 	<if test="areaId != null and areaId!=''">
				AND gu.area_id=#{areaId}
			</if>
			<if test="guideType != null and guideType!=''">
				AND gu.guide_type=#{guideType} 
			</if>
			<if test="valid != null and valid!=''">
				AND gu.valid=#{valid} 
			</if>
    		<if test="createTime != null and createTime!=''" >
       			and gu.create_time =#{createTime}
      		</if>
      	order by gu.create_time desc
	</select>
	
	<insert id="addguide" parameterType="PubGuide">
	insert into pub_guide
	(
	<if test="guideType != null and guideType!=''">
		guide_type
	</if>
	<if test="areaId != null and areaId!=''">
		,area_id
	</if>
	<if test="guideContent != null and guideContent!=''">
		,guide_content
	</if>
	<if test="userId != null and userId!=''">
		,user_id
	</if>
	<if test="valid != null and valid!=''">
		,valid
	</if>
	<if test="readTimes != null and readTimes!=''">
		,read_times
	</if>
	<if test="createTime != null and createTime!=''">
		,create_time
	</if>
	<if test="updateTime != null and updateTime!=''">
		,update_time
	</if>
	)
	value
	(
	<if test="guideType != null and guideType!=''">
		#{guideType}
	</if>
	<if test="areaId != null and areaId!=''">
		,#{areaId}
	</if>
	<if test="guideContent != null and guideContent!=''">
		,#{guideContent}
	</if>
	<if test="userId != null and userId!=''">
		,#{userId}
	</if>
	<if test="valid != null and valid!=''">
		,#{valid}
	</if>
	<if test="readTimes != null and readTimes!=''">
		,#{readTimes}
	</if>
	<if test="createTime != null and createTime!=''">
		,#{createTime}
	</if>
	<if test="updateTime != null and updateTime!=''">
		,#{updateTime}
	</if>
	)
	</insert>


	<delete id="delguide" parameterType="list">
		delete from pub_guide where guide_id in
		<foreach collection="list" index="index" item="item" open="("
			separator="," close=")">
			#{item}
		</foreach>
	</delete>
	
	<update id="updateguide" parameterType="PubGuide">
	update pub_guide set
	<if test="guideType != null and guideType!=''">
		guide_type=#{guideType}
	</if>
	<if test="areaId != null and areaId!=''">
		,area_id=#{areaId}
	</if>
	<if test="guideContent != null and guideContent!=''">
		,guide_content =#{guideContent}
	</if>
	<if test="userId != null and userId!=''">
		,user_id=#{userId}
	</if>
	<if test="valid != null and valid!=''">
		,valid=#{valid}
	</if>
	<if test="readTimes != null and readTimes!=''">
		,read_times=#{readTimes}
	</if>
	<if test="createTime != null and createTime!=''">
		,create_time=#{createTime}
	</if>
	<if test="updateTime != null and updateTime!=''">
		,update_time=#{updateTime}
	</if>
	where
	guide_id=#{guideId}

</update>
	
	
		<select id="querycontent" resultMap="pubguideMap" parameterType="java.lang.String">
		SELECT t.guide_content FROM pub_guide t WHERE t.guide_id = #{1}
	   </select>
</mapper>
