<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.eastcompeace.rights.info.RightsInfoDao">
	<resultMap id="RightsInfoMap" type="RightsInfo">
		<id column="article_id" property="articleId"/>
	    <result column="rights_id" property="rightsId"/>
	    <result column="area_id" property="areaId"/>
	    <result column="rights_name" property="rightsTypeName"/>
	    <result column="rights_from" property="rightsFrom"/>
	    <result column="rights_title" property="rightsTitle"/>
	    <result column="title_image" property="titleImage"/>
	    <result column="issue_time" property="issueTime"/>
	    <result column="user_id" property="userId"/>
	    <result column="create_time" property="createTime"/>
	    <result column="rights_content" property="rightsContent"/>
	</resultMap>
	
	<select id="queryInfo" resultMap="RightsInfoMap" parameterType="RightsInfo">
		SELECT 
			ri.article_id articleId,
			ri.rights_id rightsId,
			ri.area_id areaId,
			ri.rights_from rightsFrom,
			ri.rights_title rightsTitle,
			ri.title_image titleImage,
			date_format( ri.issue_time  ,'%Y-%m-%d %H:%i:%s') issueTime,		 
			ri.user_id userId,
			date_format( ri.create_time  ,'%Y-%m-%d %H:%i:%s') createTime,		
			<!--ri.rights_content rightsContent,-->
			rm.rights_name rightsTypeName,
			u.USER_CODE userCode,
			a.area_name areaName
		FROM 
		rights_info  ri LEFT JOIN  rights_menu rm
		ON rm.rights_id=ri.rights_id LEFT JOIN common_user u 
		ON u.USER_ID = ri.user_id LEFT JOIN conf_area a
		ON a.area_id = ri.area_id
		WHERE
			1=1
		    <if test="rightsId!=null and rightsId!=''">
			    AND ri.rights_id=#{rightsId} 
		    </if>
		    <if test="areaId!=null and areaId!=''">
			    AND ri.area_id=#{areaId}
		    </if>
		    <if test="rightsTitle!=null and rightsTitle!=''">
		    	AND ri.rights_title LIKE CONCAT('%',#{rightsTitle},'%')
		    </if>
		    <if test="rightsTypeName!=null and rightsTypeName!=''">
		    	AND rm.rights_name LIKE CONCAT('%',#{rightsTypeName},'%')
		    </if>
		     <if test="issueTime!=null and issueTime!=''">
		    	AND ri.issue_time=#{issueTime}
		    </if>
		    <if test="userId!=null and userId!=''">
		    	AND ri.user_id=#{userId}
		    </if>
		    <if test="createTime!=null and createTime!=''">
		    	AND ri.create_time=#{createTime}
		    </if>
		    <if test="uploadDateStart!=null and uploadDateStart!='' ">
				AND DATE_FORMAT(ri.create_time,'%Y-%m-%d') &gt;= #{uploadDateStart}
			</if>
			<if test="uploadDateEnd!=null and uploadDateEnd!='' ">
				AND DATE_FORMAT(ri.create_time,'%Y-%m-%d') &lt;= #{uploadDateEnd}
			</if>
		order by ri.article_id asc
	</select>
	<insert id="addRightsInfo" parameterType="RightsInfo">
	INSERT INTO
		rights_info
		(
			rights_id,
			area_id,
			rights_from,
			rights_title,
			title_image,
			issue_time,
			user_id,
			create_time,
			rights_content
			) 
		VALUES(
			#{rightsId},
			#{areaId},
			#{rightsFrom},
			#{rightsTitle},
			#{titleImage},
			#{issueTime},
			#{userId},
			NOW(),
			#{rightsContent}
			)
	</insert>
	
	<select id="querycontent" resultMap="RightsInfoMap" parameterType="string">
		SELECT 
			rights_content 
		FROM 
			rights_info  
		WHERE 
			article_id = #{0}
	</select>
	
	<update id="updateRightsInfo" parameterType="RightsInfo">
	UPDATE 
		rights_info
	SET 
		<trim suffixOverrides=",">
			<if test="rightsId!=null and rightsId!=''">
				rights_id = #{rightsId},
			</if>
			<if test="areaId!=null and areaId!=''">
				area_id = #{areaId},
			</if>
			<if test="rightsFrom!=null and rightsFrom!=''">
				rights_from = #{rightsFrom},
			</if>
			<if test="rightsTitle!=null and rightsTitle!=''">
				rights_title = #{rightsTitle},
			</if>
			<if test="titleImage!=null and titleImage!=''">
				title_image = #{titleImage},
			</if>
			<if test="issueTime!=null and issueTime!=''">
				issue_time = #{issueTime},
			</if>
			<if test="userId!=null and userId!=''">
				user_id = #{userId},
			</if>
			<if test="rightsContent!=null and rightsContent!=''">
				rights_content = #{rightsContent}
			</if>
		</trim>	
	 WHERE 
	    article_id = #{articleId}
	</update>
	
	<delete id="delRightsInfo" parameterType="list">
		delete from rights_info where article_id in
		<foreach collection="list" index="index" item="item" open="("
			separator="," close=")">
			#{item}
		</foreach>
	</delete>
	
	<select id="queryInfoByList" resultMap="RightsInfoMap" parameterType="list">
		SELECT 
			ri.title_image titleImage	
		FROM 
			rights_info  ri
		WHERE 
			article_id IN
		<foreach collection="list" index="index" item="item" open="("
			separator="," close=")">
			#{item}
		</foreach>
	</select>
	
</mapper>